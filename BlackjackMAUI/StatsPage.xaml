<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyBlackjackMAUI.StatsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:microcharts="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
    Title="Player Statistics"
    BackgroundColor="{StaticResource FeltGreen}">
    <Grid RowDefinitions="Auto, Auto, *, Auto" Padding="20" RowSpacing="15">

        <VerticalStackLayout Grid.Row="0" Spacing="15">
            <Label
                FontAttributes="Bold"
                FontSize="Large"
                HorizontalOptions="Center"
                Text="Current Run Statistics" />

            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto">
                <Label
                    Grid.Row="0"
                    Grid.Column="0"
                    Text="Hands Played:" />
                <Label
                    x:Name="lblHandsPlayed"
                    Grid.Row="0"
                    Grid.Column="1" />

                <Label
                    Grid.Row="1"
                    Grid.Column="0"
                    Text="Wins:" />
                <Label
                    x:Name="lblWins"
                    Grid.Row="1"
                    Grid.Column="1" />

                <Label
                    Grid.Row="2"
                    Grid.Column="0"
                    Text="Losses:" />
                <Label
                    x:Name="lblLosses"
                    Grid.Row="2"
                    Grid.Column="1" />

                <Label
                    Grid.Row="3"
                    Grid.Column="0"
                    Text="Pushes:" />
                <Label
                    x:Name="lblPushes"
                    Grid.Row="3"
                    Grid.Column="1" />

                <Label
                    Grid.Row="4"
                    Grid.Column="0"
                    Text="Blackjacks:" />
                <Label
                    x:Name="lblBlackjacks"
                    Grid.Row="4"
                    Grid.Column="1" />

                <Label
                    Grid.Row="5"
                    Grid.Column="0"
                    Text="Win/Loss %:" />
                <Label
                    x:Name="lblWinLossPercentage"
                    Grid.Row="5"
                    Grid.Column="1" />

                <Label
                    Grid.Row="6"
                    Grid.Column="0"
                    Text="Largest Pot Won:" />
                <Label
                    x:Name="lblLargestPotWon"
                    Grid.Row="6"
                    Grid.Column="1" />
                <Label
                    Grid.Row="7"
                    Grid.Column="0"
                    Text="Biggest Loss:" />
                <Label
                    x:Name="lblBiggestLoss"
                    Grid.Row="7"
                    Grid.Column="1" />
            </Grid>
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="1" Spacing="15">
            <Label
                Margin="0,20,0,0"
                FontAttributes="Bold"
                FontSize="Large"
                HorizontalOptions="Center"
                Text="Money Over Time" />

            <microcharts:ChartView x:Name="chartView" HeightRequest="200" />
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="2" Spacing="15">
            <Label
                Margin="0,20,0,0"
                FontAttributes="Bold"
                FontSize="Large"
                HorizontalOptions="Center"
                Text="Historical Stats" />

            <ListView x:Name="HistoryListView">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <StackLayout Padding="10" Spacing="5">
                                <Label Text="{Binding EndTime, StringFormat='Run Ended: {0:yyyy-MM-dd HH:mm}'}" FontAttributes="Bold" />
                                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
                                    <Label Grid.Row="0" Grid.Column="0" Text="Final Money:" />
                                    <Label Grid.Row="0" Grid.Column="1" Text="{Binding FinalMoney, StringFormat='${0}'}" />
                                    <Label Grid.Row="1" Grid.Column="0" Text="Hands Played:" />
                                    <Label Grid.Row="1" Grid.Column="1" Text="{Binding HandsPlayed}" />
                                    <Label Grid.Row="2" Grid.Column="0" Text="Wins/Losses:" />
                                    <Label Grid.Row="2" Grid.Column="1">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="{Binding Wins}" />
                                                <Span Text=" / " />
                                                <Span Text="{Binding Losses}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <Label Grid.Row="3" Grid.Column="0" Text="Pushes:" />
                                    <Label Grid.Row="3" Grid.Column="1" Text="{Binding Pushes}" />
                                    <Label Grid.Row="4" Grid.Column="0" Text="Blackjacks:" />
                                    <Label Grid.Row="4" Grid.Column="1" Text="{Binding Blackjacks}" />
                                    <Label Grid.Row="5" Grid.Column="0" Text="Largest Pot:" />
                                    <Label Grid.Row="5" Grid.Column="1" Text="{Binding LargestPotWon, StringFormat='${0}'}" />
                                </Grid>
                            </StackLayout>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </VerticalStackLayout>

        <Button
            Grid.Row="3"
            Clicked="BackButton_Click"
            HorizontalOptions="Center"
            Text="Back to Game" />
    </Grid>
</ContentPage>
